import { createNamespace } from 'cls-hooked';
export const _defaultNameSpaceId = 'node-session-context-id-89a2af34c0a3f';
export class ClsHookedStrategy {
    _ns;
    // eslint-disable-next-line @typescript-eslint/naming-convention
    get NS() {
        return this._ns;
    }
    constructor(params) {
        const { nameSpaceId = _defaultNameSpaceId } = params ?? {};
        this._ns = createNamespace(nameSpaceId);
    }
    get(key) {
        this._throwErrorIfInactiveContext();
        return this.NS.get(key);
    }
    set(key, value) {
        this._throwErrorIfInactiveContext();
        this.NS.set(key, value);
    }
    clear(key) {
        this._throwErrorIfInactiveContext();
        this.NS.set(key, undefined);
    }
    createSession(callback, options) {
        const { defaultValue = {} } = options ?? {};
        this.NS.run(() => {
            Object.entries(defaultValue).map(([key, value]) => this.set(key, value));
            callback();
        });
    }
    _throwErrorIfInactiveContext() {
        if (!this.NS.active) {
            throw new Error('No active session found');
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2xzLWhvb2tlZC1zdHJhdGVneS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zZXNzaW9uLXN0cmF0ZWd5L2Nscy1ob29rZWQtc3RyYXRlZ3kudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFrQixlQUFlLEVBQUUsTUFBTSxZQUFZLENBQUE7QUFJNUQsTUFBTSxDQUFDLE1BQU0sbUJBQW1CLEdBQUcsdUNBQXVDLENBQUE7QUFFMUUsTUFBTSxPQUFPLGlCQUFpQjtJQUNWLEdBQUcsQ0FBVztJQUVqQyxnRUFBZ0U7SUFDaEUsSUFBSSxFQUFFO1FBQ0wsT0FBTyxJQUFJLENBQUMsR0FBRyxDQUFBO0lBQ2hCLENBQUM7SUFFRCxZQUFZLE1BQWlDO1FBQzVDLE1BQU0sRUFBRSxXQUFXLEdBQUcsbUJBQW1CLEVBQUUsR0FBRyxNQUFNLElBQUksRUFBRSxDQUFBO1FBQzFELElBQUksQ0FBQyxHQUFHLEdBQUcsZUFBZSxDQUFDLFdBQVcsQ0FBQyxDQUFBO0lBQ3hDLENBQUM7SUFFRCxHQUFHLENBQUksR0FBVztRQUNqQixJQUFJLENBQUMsNEJBQTRCLEVBQUUsQ0FBQTtRQUVuQyxPQUFPLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBa0IsQ0FBQTtJQUN6QyxDQUFDO0lBRUQsR0FBRyxDQUFJLEdBQVcsRUFBRSxLQUFRO1FBQzNCLElBQUksQ0FBQyw0QkFBNEIsRUFBRSxDQUFBO1FBQ25DLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxLQUFLLENBQUMsQ0FBQTtJQUN4QixDQUFDO0lBRUQsS0FBSyxDQUFDLEdBQVc7UUFDaEIsSUFBSSxDQUFDLDRCQUE0QixFQUFFLENBQUE7UUFDbkMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLFNBQVMsQ0FBQyxDQUFBO0lBQzVCLENBQUM7SUFFRCxhQUFhLENBQUMsUUFBb0IsRUFBRSxPQUE4QjtRQUNqRSxNQUFNLEVBQUUsWUFBWSxHQUFHLEVBQUUsRUFBRSxHQUFHLE9BQU8sSUFBSSxFQUFFLENBQUE7UUFDM0MsSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFO1lBQ2hCLE1BQU0sQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLEVBQUUsS0FBSyxDQUFDLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUE7WUFDeEUsUUFBUSxFQUFFLENBQUE7UUFDWCxDQUFDLENBQUMsQ0FBQTtJQUNILENBQUM7SUFFUyw0QkFBNEI7UUFDckMsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsTUFBTSxFQUFFLENBQUM7WUFDckIsTUFBTSxJQUFJLEtBQUssQ0FBQyx5QkFBeUIsQ0FBQyxDQUFBO1FBQzNDLENBQUM7SUFDRixDQUFDO0NBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyB0eXBlIE5hbWVzcGFjZSwgY3JlYXRlTmFtZXNwYWNlIH0gZnJvbSAnY2xzLWhvb2tlZCdcblxuaW1wb3J0IHsgdHlwZSBDcmVhdGVTZXNzaW9uT3B0aW9ucywgdHlwZSBTZXNzaW9uU3RyYXRlZ3kgfSBmcm9tICcjc3JjL3Nlc3Npb24tc3RyYXRlZ3kvc2Vzc2lvbi1zdHJhdGVneSdcblxuZXhwb3J0IGNvbnN0IF9kZWZhdWx0TmFtZVNwYWNlSWQgPSAnbm9kZS1zZXNzaW9uLWNvbnRleHQtaWQtODlhMmFmMzRjMGEzZidcblxuZXhwb3J0IGNsYXNzIENsc0hvb2tlZFN0cmF0ZWd5IGltcGxlbWVudHMgU2Vzc2lvblN0cmF0ZWd5IHtcblx0cHJvdGVjdGVkIHJlYWRvbmx5IF9uczogTmFtZXNwYWNlXG5cblx0Ly8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uYW1pbmctY29udmVudGlvblxuXHRnZXQgTlMoKTogTmFtZXNwYWNlIHtcblx0XHRyZXR1cm4gdGhpcy5fbnNcblx0fVxuXG5cdGNvbnN0cnVjdG9yKHBhcmFtcz86IHsgbmFtZVNwYWNlSWQ/OiBzdHJpbmcgfSkge1xuXHRcdGNvbnN0IHsgbmFtZVNwYWNlSWQgPSBfZGVmYXVsdE5hbWVTcGFjZUlkIH0gPSBwYXJhbXMgPz8ge31cblx0XHR0aGlzLl9ucyA9IGNyZWF0ZU5hbWVzcGFjZShuYW1lU3BhY2VJZClcblx0fVxuXG5cdGdldDxUPihrZXk6IHN0cmluZyk6IFQgfCB1bmRlZmluZWQge1xuXHRcdHRoaXMuX3Rocm93RXJyb3JJZkluYWN0aXZlQ29udGV4dCgpXG5cblx0XHRyZXR1cm4gdGhpcy5OUy5nZXQoa2V5KSBhcyBUIHwgdW5kZWZpbmVkXG5cdH1cblxuXHRzZXQ8VD4oa2V5OiBzdHJpbmcsIHZhbHVlOiBUKTogdm9pZCB7XG5cdFx0dGhpcy5fdGhyb3dFcnJvcklmSW5hY3RpdmVDb250ZXh0KClcblx0XHR0aGlzLk5TLnNldChrZXksIHZhbHVlKVxuXHR9XG5cblx0Y2xlYXIoa2V5OiBzdHJpbmcpOiB2b2lkIHtcblx0XHR0aGlzLl90aHJvd0Vycm9ySWZJbmFjdGl2ZUNvbnRleHQoKVxuXHRcdHRoaXMuTlMuc2V0KGtleSwgdW5kZWZpbmVkKVxuXHR9XG5cblx0Y3JlYXRlU2Vzc2lvbihjYWxsYmFjazogKCkgPT4gdm9pZCwgb3B0aW9ucz86IENyZWF0ZVNlc3Npb25PcHRpb25zKTogdm9pZCB7XG5cdFx0Y29uc3QgeyBkZWZhdWx0VmFsdWUgPSB7fSB9ID0gb3B0aW9ucyA/PyB7fVxuXHRcdHRoaXMuTlMucnVuKCgpID0+IHtcblx0XHRcdE9iamVjdC5lbnRyaWVzKGRlZmF1bHRWYWx1ZSkubWFwKChba2V5LCB2YWx1ZV0pID0+IHRoaXMuc2V0KGtleSwgdmFsdWUpKVxuXHRcdFx0Y2FsbGJhY2soKVxuXHRcdH0pXG5cdH1cblxuXHRwcm90ZWN0ZWQgX3Rocm93RXJyb3JJZkluYWN0aXZlQ29udGV4dCgpOiB2b2lkIHtcblx0XHRpZiAoIXRoaXMuTlMuYWN0aXZlKSB7XG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoJ05vIGFjdGl2ZSBzZXNzaW9uIGZvdW5kJylcblx0XHR9XG5cdH1cbn1cbiJdfQ==